---
import { getCollection, render } from "astro:content";
import Blog from "@/layouts/blog.astro";
import { getReadingTime } from "@/lib/read-time";
import { getRelatedArticles } from "@/lib/related";
import Link from "@/components/link.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blogs");

  return Promise.all(
    posts.map(async (post) => {
      const { Content } = await render(post);

      return {
        params: { slug: post.id },
        props: {
          data: post.data,
          Content,
          readingTime: getReadingTime(post.body),
          articles: getRelatedArticles(post, posts, 3),
        },
      };
    }),
  );
}

const { data, Content, readingTime, articles } = Astro.props;
---

<Blog {...data} time={readingTime.time} articles={articles}>
  <Content components={{ a: Link }} />
</Blog>
