---
import { getCollection } from "astro:content";
import BlogsHero from "@/components/blogs/hero";
import siteConfig from "@/constants/site.json";
import Page from "@/layouts/page.astro";
import { ArrowRight } from "lucide-react";
import Category from "@/components/category.astro";
import { formatDate } from "@/lib/date";

interface Props {
  tab?: string;
}

const { tab = "All" } = Astro.props;
const blogs = await getCollection("blogs");
const posts =
  tab === "All" ? blogs : blogs.filter((e) => e.data.category === tab);
const sortedPosts = posts.sort(
  (a, b) =>
    new Date(b.data.createdAt).getTime() - new Date(a.data.createdAt).getTime(),
);

const title = `Blogs | ${siteConfig.name}`;
const description = `Explore our comprehensive collection of blog posts on education, child welfare, women's empowerment, and social development in rural Bihar.`;
const schema = {
  "@context": "https://schema.org",
  "@type": "Blog",
  url: Astro.url.href,
  name: title,
  description: description,
  mainEntity: {
    "@type": "Organization",
    name: siteConfig.name,
    logo: siteConfig.logo,
    url: siteConfig.url,
  },
  blogPost: sortedPosts.map((post) => ({
    "@type": "BlogPosting",
    headline: post.data.title,
    description: post.data.description,
    url: `${siteConfig.url}/blogs/${post.id}`,
    datePublished: post.data.createdAt,
    author: {
      "@type": "Organization",
      name: siteConfig.name,
    },
  })),
};

const CategoriesList = [
  "All",
  "Partnership",
  "Donation",
  "Education",
  "Programs",
];
---

<Page title={title} description={description} schema={schema}>
  <main id="main-content" role="main">
    <BlogsHero client:load />
    <section class="m-auto max-w-6xl px-4 pb-16 sm:px-6">
      <div class="container mx-auto px-4 text-sm">
        <div class="flex flex-wrap items-center justify-center gap-4 pb-12">
          {
            CategoriesList.map((category) => (
              <a
                href={
                  category === "All"
                    ? "/blogs/"
                    : `/blogs/${category.toLowerCase()}/`
                }
              >
                {category === tab && (
                  <span class="bg-primary/10 text-primary inline-flex cursor-pointer items-center gap-2 rounded-full px-2.5 py-1 font-medium">
                    <Category className="size-3.5" category={category} />
                    {category}
                  </span>
                )}
                {category !== tab && (
                  <span class="bg-muted text-muted-foreground inline-flex cursor-pointer items-center gap-2 rounded-full px-2.5 py-1 font-medium">
                    <Category className="size-3.5" category={category} />
                    {category}
                  </span>
                )}
              </a>
            ))
          }
        </div>
        <div class="grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3">
          {
            sortedPosts.map((post) => (
              <a href={`/blogs/${post.id}`}>
                <article class="group border-border hover:border-primary/30 rounded-xl border bg-white p-6 transition-all">
                  <div>
                    <div class="mb-2 flex items-center justify-between">
                      <span class="bg-muted text-muted-foreground mb-2 inline-flex items-center gap-1.5 rounded-full px-2.5 py-1 text-xs font-medium">
                        <Category
                          className="size-3"
                          category={post.data.category}
                        />
                        {post.data.category}
                      </span>
                      <time
                        class="text-muted-foreground mb-2 text-xs font-light"
                        datetime={formatDate(post.data.createdAt)}
                      >
                        {formatDate(post.data.createdAt)}
                      </time>
                    </div>
                    <h3 class="text-foreground group-hover:text-primary mb-2 line-clamp-2 font-medium transition-colors">
                      {post.data.title}
                    </h3>
                    <p class="text-muted-foreground line-clamp-2 text-sm">
                      {post.data.description}
                    </p>
                    <p class="text-primary hover:text-primary/90 mt-2 inline-flex items-center gap-2 text-sm font-medium transition-all duration-300 group-hover:gap-4">
                      Read More
                      <ArrowRight className="size-3.5" />
                    </p>
                  </div>
                </article>
              </a>
            ))
          }
        </div>
      </div>
    </section>
  </main>
</Page>
