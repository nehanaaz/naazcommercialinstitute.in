---
import siteConfig from "@/constants/site.json";
import { motion } from "framer-motion";
import "../styles/global.css";
import {
  ArrowLeft,
  BookOpen,
  Building2,
  Calendar,
  Clock,
  Dot,
  GraduationCap,
  Heart,
  Users,
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { BlogShare } from "@/components/share";
import { formatDate } from "@/lib/date";
import Page from "./page.astro";
import type { CollectionEntry } from "astro:content";
import { getBlogSchema } from "@/lib/schema";

type Blog = CollectionEntry<"blogs">;

interface Props {
  title: string;
  description: string;
  keywords: string;
  time?: string;
  category?: "About Us" | "Donation" | "Programs" | "Education" | "Partnership";
  related?: string[];
  createdAt: Date | string;
  lastUpdatedAt?: Date | string;
  articles?: {
    category: string;
    slug: string;
    title: string;
    description: string;
  }[];
  post: Blog;
}

const {
  title,
  description = "Naaz Commercial Institute (NGO) provides vocational training, skill development, and community programs to empower individuals and create sustainable livelihoods.",
  keywords = "Naaz Commercial Institute, NGO, vocational training, community development, skill development, training institute",
  time,
  category = "Education",
  related,
  createdAt,
  lastUpdatedAt,
  articles,
  post,
} = Astro.props;
const siteTitle = `${title} | ${siteConfig.name}`;

const categoryIcons: Record<string, React.ElementType> = {
  "About Us": Building2,
  Donation: Heart,
  Programs: GraduationCap,
  Education: BookOpen,
  Partnership: Users,
};

const CategoryIcon = categoryIcons[category];
const schema = getBlogSchema(
  post,
  Astro.url.href,
  siteConfig.name,
  siteConfig.logo,
);
---

<Page
  title={siteTitle}
  description={description}
  keywords={keywords}
  schema={schema}
>
  <main id="main-content" role="main">
    <section
      class="from-primary/5 to-background relative bg-gradient-to-b pt-32"
    >
      <div class="mx-auto max-w-6xl px-6 lg:px-8">
        <a
          href="/blogs/"
          class="text-muted-foreground hover:text-primary mb-8 inline-flex items-center gap-2 text-sm transition-colors"
        >
          <ArrowLeft className="size-4" />
          Back to All Articles
        </a>

        <div class="mb-6 flex items-center gap-3">
          <span
            class="bg-primary/10 text-primary inline-flex items-center gap-1.5 rounded-full px-3 py-1 text-xs font-medium"
          >
            <CategoryIcon className="size-3.5" />
            {category}
          </span>
          <span class="text-muted-foreground flex items-center gap-1.5 text-xs">
            <Clock className="size-3.5" />{time}
          </span>
          <Dot className="text-muted-foreground size-3.5" />
          <span class="text-muted-foreground flex items-center gap-1.5 text-xs">
            <Calendar className="size-3.5" />{formatDate(createdAt)}
          </span>
        </div>

        <h1
          class="text-foreground mb-6 font-serif text-3xl tracking-tight md:text-4xl lg:text-5xl"
        >
          {title}
        </h1>

        <p class="text-muted-foreground mb-8 text-lg leading-relaxed">
          {description}
        </p>
      </div>
    </section>
    <section
      id="blog-content"
      aria-labelledby="blog-content"
      class="relative mx-auto max-w-6xl overflow-hidden px-6 pb-10 lg:px-8"
    >
      <div class="markdown flex flex-col gap-4">
        <slot />
      </div>
      {
        (related?.length ?? 0) > 0 && (
          <div class="border-border mt-8 flex flex-wrap gap-2 border-t py-8">
            <span class="text-muted-foreground mr-2 text-sm">
              Related Topics:
            </span>
            {related?.map((keyword) => (
              <span class="bg-muted text-muted-foreground rounded-full px-3 py-1 text-xs">
                {keyword}
              </span>
            ))}
          </div>
        )
      }
      <div class="text-muted-foreground mt-8 flex items-center gap-1.5 text-sm">
        Last updated:
        <span>
          {formatDate(lastUpdatedAt ?? createdAt)}
        </span>
      </div>
      <motion.div
        client:load
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        viewport={{ once: true }}
        className="from-primary/10 via-primary/5 mt-12 rounded-2xl bg-gradient-to-br to-transparent p-8 text-center"
      >
        <h3 class="text-foreground mb-3 font-serif text-2xl tracking-tight">
          Be Part of Our Journey
        </h3>
        <p class="text-muted-foreground mx-auto mb-6 max-w-md">
          Join us in transforming lives through education and skill development
          in rural Bihar.
        </p>
        <a href="/donate/">
          <Button className="cursor-pointer rounded-full px-8">
            Support Our Mission
          </Button>
        </a>
      </motion.div>
    </section>
    <section
      id="share-section"
      aria-labelledby="share-section"
      class="relative mx-auto max-w-6xl overflow-hidden px-6 lg:px-8"
    >
      <div
        class="border-border flex items-center justify-between border-t py-6"
      >
        <p class="text-muted-foreground text-sm">
          Found this helpful? Share it with others.
        </p>
        <BlogShare client:load title={title} description={description} />
      </div>
    </section>

    {
      (articles?.length ?? 0) > 0 && (
        <section class="bg-muted/30 pb-16">
          <div class="mx-auto max-w-6xl px-6">
            <h2 class="text-foreground mb-8 text-center font-serif text-2xl tracking-tight">
              More Articles
            </h2>
            <div class="grid gap-6 md:grid-cols-3">
              {articles!.map((blog, index) => {
                const RelatedIcon = categoryIcons[blog.category] || BookOpen;
                return (
                  <motion.a
                    client:load
                    key={blog.slug}
                    href={`/blogs/${blog.slug}`}
                    initial={{ opacity: 0, y: 20 }}
                    whileInView={{ opacity: 1, y: 0 }}
                    viewport={{ once: true }}
                    transition={{ duration: 0.5, delay: index * 0.1 }}
                    className="group bg-white rounded-xl p-6 border border-border hover:border-primary/30 transition-all"
                  >
                    <span class="bg-muted text-muted-foreground mb-4 inline-flex items-center gap-1.5 rounded-full px-2.5 py-1 text-xs font-medium">
                      <RelatedIcon className="size-3" />
                      {blog.category}
                    </span>
                    <h3 class="text-foreground group-hover:text-primary mb-2 line-clamp-2 font-medium transition-colors">
                      {blog.title}
                    </h3>
                    <p class="text-muted-foreground line-clamp-2 text-sm">
                      {blog.description}
                    </p>
                  </motion.a>
                );
              })}
            </div>
          </div>
        </section>
      )
    }
  </main>
</Page>
